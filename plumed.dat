# PLUMED input file for protein orientation analysis
# Generated by rotmd
# https://github.com/yourusername/rotmd
#
# Collective variables: theta
# Membrane normal: [0.0, 0.0, 1.0]
#
# PLUMED version: 2.8+
# Units: nm, ps, kJ/mol, degrees

# Restart handling
RESTART

# Define protein atom group
protein: GROUP ATOMS=1-500

# Compute center of mass
com: COM ATOMS=protein

# Compute gyration tensor for principal axes
gyration: GYRATION ATOMS=protein TYPE=GTPC_VECTOR

# Extract principal components (gyration eigenvalues)
gyr_eig: GYRATION ATOMS=protein TYPE=GTPC

# Define orientation collective variables
#
# Strategy: Use principal axes from gyration tensor
# theta = tilt angle of principal axis relative to membrane normal

# Theta: Tilt angle relative to membrane normal
# Computed from principal axis orientation
#
# Method: Define reference vectors and compute angle

# Principal axis (approximated by end-to-end vector for now)
# TODO: Use custom PLUMED module for exact principal axes
# For now, we use a simplified approach:

# Define N-terminus and C-terminus groups (adjust atom ranges)
nterm: COM ATOMS=1-301      # First residues
cterm: COM ATOMS=2831-3131  # Last residues

# Principal axis approximation: vector from N to C terminus
paxis: DISTANCE ATOMS=nterm,cterm COMPONENTS

# Normalize to get unit vector (using MATHEVAL)
paxis_norm: MATHEVAL ARG=paxis.x,paxis.y,paxis.z
    FUNC=sqrt(x*x+y*y+z*z) PERIODIC=NO

# Dot product with membrane normal
# membrane_normal = [0.000, 0.000, 1.000]
dot_product: MATHEVAL ARG=paxis.x,paxis.y,paxis.z,paxis_norm
    FUNC=(0.0*x+0.0*y+1.0*z)/w
    PERIODIC=NO

# Theta = arccos(dot_product), converted to degrees
theta: MATHEVAL ARG=dot_product
    FUNC=acos(x)*57.2958  # 180/pi
    PERIODIC=NO

# Wall potentials to restrict theta range

# Lower wall at theta = 20.0°
LOWER_WALLS ...
    ARG=theta
    AT=20.0
    KAPPA=150.0
    EXP=2
    EPS=1.0
    OFFSET=0.0
... LOWER_WALLS

# Upper wall at theta = 90.0°
UPPER_WALLS ...
    ARG=theta
    AT=90.0
    KAPPA=150.0
    EXP=2
    EPS=1.0
    OFFSET=0.0
... UPPER_WALLS

# Output collective variables to file
PRINT ...
    ARG=theta
    STRIDE=100
    FILE=COLVAR
    FMT=%12.6f
... PRINT


# End of PLUMED input
